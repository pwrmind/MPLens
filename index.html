<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструмент сравнения цен</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .price-increase {
            color: #ef4444;
        }
        .price-decrease {
            color: #22c55e;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .dark .price-increase {
            color: #f87171;
        }
        .dark .price-decrease {
            color: #4ade80;
        }
        
        /* Стили для переключателя темы */
        .theme-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 34px;
        }
        
        .theme-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .theme-slider {
            background-color: #2563eb;
        }
        
        input:checked + .theme-slider:before {
            transform: translateX(30px);
        }
        
        .theme-slider i {
            position: absolute;
            top: 6px;
            font-size: 18px;
        }
        
        .fa-sun {
            left: 6px;
            color: #f59e0b;
        }
        
        .fa-moon {
            right: 6px;
            color: #e5e7eb;
        }
        
        .dark {
            color: #e5e7eb;
            background-color: #111827;
        }
        
        .dark .bg-white {
            background-color: #1f2937;
        }
        
        .dark .border-gray-200 {
            border-color: #374151;
        }
        
        .dark .text-gray-500 {
            color: #9ca3af;
        }
        
        .dark .text-gray-900 {
            color: #f3f4f6;
        }
        
        .dark .bg-gray-50 {
            background-color: #1f2937;
        }
        
        .dark .bg-indigo-50 {
            background-color: #1e3a8a;
        }
        
        .dark .bg-indigo-600 {
            background-color: #3b82f6;
        }
        
        .dark .hover\:bg-indigo-700:hover {
            background-color: #2563eb;
        }
        
        .dark .bg-red-100 {
            background-color: #7f1d1d;
        }
        
        .dark .bg-green-100 {
            background-color: #14532d;
        }
        
        .dark .text-red-800 {
            color: #fecaca;
        }
        
        .dark .text-green-800 {
            color: #bbf7d0;
        }
        
        .competitor-badge {
            background-color: #fde68a;
            color: #92400e;
        }
        
        .dark .competitor-badge {
            background-color: #92400e;
            color: #fde68a;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <div id="app" class="flex flex-col min-h-screen dark:bg-gray-900">
        <!-- Шапка -->
        <header class="bg-white dark:bg-gray-800 shadow py-4 px-6">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-indigo-700 dark:text-indigo-400">
                    <i class="fas fa-store mr-2"></i>Инструмент сравнения цен
                </h1>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-sun text-yellow-400"></i>
                        <label class="theme-toggle">
                            <input type="checkbox" v-model="darkMode" @change="toggleTheme">
                            <span class="theme-slider">
                                <i class="fas fa-sun"></i>
                                <i class="fas fa-moon"></i>
                            </span>
                        </label>
                        <i class="fas fa-moon text-blue-300"></i>
                    </div>
                    <div class="relative">
                        <input v-model="searchQuery" type="text" placeholder="Поиск SKU..." 
                               class="pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400 dark:text-gray-300"></i>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="text-sm font-medium dark:text-gray-300">
                            <i class="fas fa-user mr-1"></i>Менеджер: {{ managerName }}
                        </div>
                        <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center dark:bg-indigo-700 dark:hover:bg-indigo-600">
                            <i class="fas fa-download mr-2"></i> Экспорт
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Основной контент -->
        <main class="flex flex-1 overflow-hidden">
            <!-- Боковая панель - SKU менеджера -->
            <div class="w-1/4 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col">
                <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-lg font-semibold mb-4 dark:text-gray-200">
                        <i class="fas fa-boxes mr-2"></i>Мои товары
                    </h2>
                    <div class="flex mb-4">
                        <input v-model="newSku" type="text" placeholder="Добавить новый SKU..." 
                               class="flex-1 px-4 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        <button @click="addNewManagerSku" 
                                class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-r-lg dark:bg-indigo-700 dark:hover:bg-indigo-600">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="overflow-y-auto flex-1 scrollbar-hide">
                    <div v-for="(sku, index) in filteredManagerSkus" :key="index" 
                         @click="selectManagerSku(sku)"
                         :class="{'bg-indigo-50 dark:bg-indigo-900 border-l-4 border-indigo-500 dark:border-indigo-400': selectedManagerSku && selectedManagerSku.id === sku.id}"
                         class="p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer flex justify-between items-center">
                        <div>
                            <div class="font-medium dark:text-gray-200">{{ sku.name }}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">ID: {{ sku.id }}</div>
                        </div>
                        <div class="flex space-x-2">
                            <span class="text-xs px-2 py-1 rounded-full" 
                                  :class="sku.priceChange >= 0 ? 'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200' : 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200'">
                                {{ sku.priceChange >= 0 ? '↑' : '↓' }} {{ Math.abs(sku.priceChange) }}%
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Основное рабочее пространство -->
            <div class="flex-1 flex flex-col overflow-hidden">
                <!-- График -->
                <div class="bg-white dark:bg-gray-800 p-4 border-b border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold dark:text-gray-200">
                            <span v-if="selectedManagerSku">История цен для {{ selectedManagerSku.name }}</span>
                            <span v-else class="dark:text-gray-400">Выберите ваш товар для сравнения</span>
                        </h2>
                        <div class="flex space-x-2">
                            <select v-model="timeRange" class="border border-gray-300 rounded px-3 py-1 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="7">7 дней</option>
                                <option value="30">30 дней</option>
                                <option value="90">90 дней</option>
                            </select>
                            <button @click="toggleFullscreen" class="text-gray-500 hover:text-indigo-600 dark:text-gray-400 dark:hover:text-indigo-400">
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    <div class="h-64">
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>

                <!-- Таблица сравнения с конкурентами -->
                <div class="flex-1 overflow-auto dark:bg-gray-800">
                    <div class="min-w-full">
                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                            <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">
                                        Характеристика
                                    </th>
                                    <th v-if="selectedManagerSku" scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">
                                        <div class="flex items-center justify-between">
                                            <span>Ваш товар: {{ selectedManagerSku.name }}</span>
                                        </div>
                                    </th>
                                    <th v-for="(competitor, index) in comparedCompetitors" :key="index" scope="col" 
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider dark:text-gray-300">
                                        <div class="flex items-center justify-between">
                                            <span>
                                                <span class="competitor-badge text-xs px-2 py-1 rounded mr-2">Конкурент</span>
                                                {{ competitor.name }}
                                            </span>
                                            <button @click="removeCompetitor(competitor)" class="text-gray-400 hover:text-red-500 dark:hover:text-red-400">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>
                                    </th>
                                    <th scope="col" class="px-6 py-3 text-center">
                                        <button @click="addCompetitor" 
                                                class="text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 text-sm font-medium">
                                            <i class="fas fa-plus mr-1"></i> Добавить конкурента
                                        </button>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700">
                                <tr v-for="(row, rowIndex) in comparisonRows" :key="rowIndex" class="hover:bg-gray-50 dark:hover:bg-gray-700">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-200">
                                        {{ row.characteristic }}
                                    </td>
                                    <td v-if="selectedManagerSku" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                                        <div v-if="row.values.manager">
                                            {{ row.values.manager.value }}
                                            <span v-if="row.values.manager.trend === 'up'" 
                                                  class="price-increase ml-1"><i class="fas fa-arrow-up"></i></span>
                                            <span v-else-if="row.values.manager.trend === 'down'" 
                                                  class="price-decrease ml-1"><i class="fas fa-arrow-down"></i></span>
                                        </div>
                                        <div v-else class="text-gray-400">-</div>
                                    </td>
                                    <td v-for="(competitor, compIndex) in comparedCompetitors" :key="compIndex" 
                                        class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300">
                                        <div v-if="row.values[competitor.id]">
                                            {{ row.values[competitor.id].value }}
                                            <span v-if="row.values[competitor.id].trend === 'up'" 
                                                  class="price-increase ml-1"><i class="fas fa-arrow-up"></i></span>
                                            <span v-else-if="row.values[competitor.id].trend === 'down'" 
                                                  class="price-decrease ml-1"><i class="fas fa-arrow-down"></i></span>
                                        </div>
                                        <div v-else class="text-gray-400">-</div>
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <!-- Футер -->
        <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 py-4 px-6 text-center text-sm text-gray-500 dark:text-gray-400">
            <p>Инструмент сравнения цен на маркетплейсах • {{ new Date().getFullYear() }}</p>
        </footer>
    </div>

    <script>
        new Vue({
            el: '#app',
            data: {
                managerName: "Иван Петров",
                searchQuery: '',
                newSku: '',
                timeRange: '30',
                selectedManagerSku: null,
                comparedCompetitors: [],
                darkMode: false,
                managerSkus: [
                    { id: 'mgr001', name: 'Смартфон Samsung Galaxy S21', priceHistory: [], priceChange: 2.5 },
                    { id: 'mgr002', name: 'Ноутбук Apple MacBook Air', priceHistory: [], priceChange: -1.2 },
                    { id: 'mgr003', name: 'Наушники Sony WH-1000XM4', priceHistory: [], priceChange: 0.8 },
                    { id: 'mgr004', name: 'Умные часы Apple Watch', priceHistory: [], priceChange: 3.1 },
                    { id: 'mgr005', name: 'Планшет Samsung Galaxy Tab', priceHistory: [], priceChange: -0.5 },
                ],
                competitorSkus: [
                    { id: 'comp001', name: 'Смартфон Galaxy S21 (Конкурент 1)', priceHistory: [], priceChange: 1.8 },
                    { id: 'comp002', name: 'MacBook Air (Конкурент 2)', priceHistory: [], priceChange: -0.7 },
                    { id: 'comp003', name: 'Наушники Sony (Конкурент 1)', priceHistory: [], priceChange: 2.1 },
                    { id: 'comp004', name: 'Apple Watch (Конкурент 3)', priceHistory: [], priceChange: 4.2 },
                    { id: 'comp005', name: 'Планшет Galaxy Tab (Конкурент 2)', priceHistory: [], priceChange: -1.3 },
                    { id: 'comp006', name: 'Фитнес-браслет Xiaomi (Конкурент 4)', priceHistory: [], priceChange: 1.7 },
                    { id: 'comp007', name: 'PlayStation 5 (Конкурент 5)', priceHistory: [], priceChange: -2.3 },
                    { id: 'comp008', name: 'Электронная книга Kindle (Конкурент 3)', priceHistory: [], priceChange: 0.4 }
                ],
                chart: null,
                comparisonRows: [
                    { characteristic: 'Текущая цена', values: {} },
                    { characteristic: 'Минимальная цена (30 дн.)', values: {} },
                    { characteristic: 'Максимальная цена (30 дн.)', values: {} },
                    { characteristic: 'Средняя цена', values: {} },
                    { characteristic: 'Количество предложений', values: {} },
                    { characteristic: 'Рейтинг товара', values: {} },
                    { characteristic: 'Доступность', values: {} },
                    { characteristic: 'Доставка', values: {} },
                    { characteristic: 'Гарантия', values: {} }
                ]
            },
            computed: {
                filteredManagerSkus() {
                    if (!this.searchQuery) return this.managerSkus;
                    const query = this.searchQuery.toLowerCase();
                    return this.managerSkus.filter(sku => 
                        sku.name.toLowerCase().includes(query) || 
                        sku.id.toLowerCase().includes(query)
                    );
                }
            },
            watch: {
                selectedManagerSku() {
                    this.updateChart();
                    this.updateComparisonTable();
                },
                comparedCompetitors() {
                    this.updateChart();
                    this.updateComparisonTable();
                },
                timeRange() {
                    this.updateChart();
                },
                darkMode() {
                    this.updateChart();
                }
            },
            mounted() {
                // Проверяем сохранённую тему или системные настройки
                if (localStorage.getItem('darkMode')) {
                    this.darkMode = localStorage.getItem('darkMode') === 'true';
                } else {
                    this.darkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                }
                
                this.applyTheme();
                this.generatePriceHistory();
                this.initChart();
                
                // Выбираем первый SKU менеджера по умолчанию
                if (this.managerSkus.length > 0) {
                    this.selectedManagerSku = this.managerSkus[0];
                }
            },
            methods: {
                applyTheme() {
                    if (this.darkMode) {
                        document.body.classList.add('dark');
                    } else {
                        document.body.classList.remove('dark');
                    }
                },
                toggleTheme() {
                    this.darkMode = !this.darkMode;
                    localStorage.setItem('darkMode', this.darkMode);
                    this.applyTheme();
                    this.updateChart();
                },
                generatePriceHistory() {
                    const today = new Date();
                    
                    // Генерация данных для SKU менеджера
                    this.managerSkus.forEach(sku => {
                        this.generateSkuPriceHistory(sku);
                    });
                    
                    // Генерация данных для SKU конкурентов
                    this.competitorSkus.forEach(sku => {
                        this.generateSkuPriceHistory(sku);
                    });
                },
                generateSkuPriceHistory(sku) {
                    const today = new Date();
                    const history = [];
                    let basePrice = Math.floor(Math.random() * 20000) + 5000;
                    
                    for (let i = 90; i >= 0; i--) {
                        const date = new Date(today);
                        date.setDate(today.getDate() - i);
                        
                        // Генерация колебаний цен
                        const fluctuation = Math.random() > 0.7 ? (Math.random() * 0.1 - 0.05) * basePrice : 0;
                        const price = Math.round(basePrice + fluctuation);
                        
                        history.push({
                            date: date.toISOString().split('T')[0],
                            price
                        });
                    }
                    
                    // Рассчитаем изменение цены за последние 30 дней
                    const currentPrice = history[history.length - 1].price;
                    const monthAgoPrice = history[history.length - 30].price;
                    sku.priceChange = parseFloat(((currentPrice - monthAgoPrice) / monthAgoPrice * 100).toFixed(1));
                    
                    sku.priceHistory = history;
                },
                initChart() {
                    const ctx = document.getElementById('priceChart').getContext('2d');
                    this.chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: []
                        },
                        options: this.getChartOptions()
                    });
                },
                getChartOptions() {
                    const isDark = this.darkMode;
                    const textColor = isDark ? '#e5e7eb' : '#374151';
                    const gridColor = isDark ? 'rgba(55, 65, 81, 0.5)' : 'rgba(0, 0, 0, 0.05)';
                    
                    return {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    color: gridColor
                                },
                                ticks: {
                                    color: textColor,
                                    callback: function(value) {
                                        return value.toLocaleString('ru-RU') + ' ₽';
                                    }
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: textColor
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + context.parsed.y.toLocaleString('ru-RU') + ' ₽';
                                    }
                                },
                                backgroundColor: isDark ? '#1f2937' : '#ffffff',
                                titleColor: isDark ? '#e5e7eb' : '#374151',
                                bodyColor: isDark ? '#e5e7eb' : '#374151',
                                borderColor: isDark ? '#374151' : '#e5e7eb'
                            },
                            legend: {
                                position: 'top',
                                labels: {
                                    boxWidth: 12,
                                    padding: 20,
                                    color: textColor
                                }
                            }
                        }
                    };
                },
                updateChart() {
                    if (!this.chart) return;
                    
                    const days = parseInt(this.timeRange);
                    const today = new Date();
                    const labels = [];
                    
                    for (let i = days - 1; i >= 0; i--) {
                        const date = new Date(today);
                        date.setDate(today.getDate() - i);
                        labels.push(date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' }));
                    }
                    
                    const datasets = [];
                    const colors = [
                        '#4f46e5', // Индиго - ваш товар
                        '#ef4444', // Красный - конкурент 1
                        '#10b981', // Зеленый - конкурент 2
                        '#f59e0b', // Желтый - конкурент 3
                        '#8b5cf6', // Фиолетовый - конкурент 4
                        '#ec4899'  // Розовый - конкурент 5
                    ];
                    
                    // Добавить товар менеджера
                    if (this.selectedManagerSku) {
                        const prices = this.getPricesForPeriod(this.selectedManagerSku, days);
                        datasets.push({
                            label: `Ваш товар: ${this.selectedManagerSku.name}`,
                            data: prices,
                            borderColor: colors[0],
                            backgroundColor: this.darkMode ? 'rgba(79, 70, 229, 0.2)' : 'rgba(79, 70, 229, 0.1)',
                            borderWidth: 3,
                            tension: 0.2,
                            fill: false
                        });
                    }
                    
                    // Добавить конкурентов
                    this.comparedCompetitors.forEach((competitor, index) => {
                        const prices = this.getPricesForPeriod(competitor, days);
                        datasets.push({
                            label: competitor.name,
                            data: prices,
                            borderColor: colors[(index + 1) % colors.length],
                            borderWidth: 2,
                            borderDash: [5, 5],
                            tension: 0.2,
                            fill: false
                        });
                    });
                    
                    // Обновляем опции для темной темы
                    this.chart.options = this.getChartOptions();
                    
                    this.chart.data.labels = labels;
                    this.chart.data.datasets = datasets;
                    this.chart.update();
                },
                getPricesForPeriod(sku, days) {
                    const startIndex = sku.priceHistory.length - days;
                    return sku.priceHistory.slice(startIndex).map(item => item.price);
                },
                selectManagerSku(sku) {
                    this.selectedManagerSku = sku;
                },
                addNewManagerSku() {
                    if (!this.newSku.trim()) return;
                    
                    const newId = 'mgr' + (Math.floor(Math.random() * 900) + 100);
                    const newSkuObj = {
                        id: newId,
                        name: this.newSku,
                        priceHistory: [],
                        priceChange: 0
                    };
                    
                    this.generateSkuPriceHistory(newSkuObj);
                    this.managerSkus.push(newSkuObj);
                    this.newSku = '';
                    
                    if (!this.selectedManagerSku) {
                        this.selectedManagerSku = newSkuObj;
                    }
                },
                addCompetitor() {
                    if (this.comparedCompetitors.length >= 5) {
                        alert('Максимум 5 конкурентов для сравнения');
                        return;
                    }
                    
                    // Выбираем случайного конкурента, которого еще не добавили
                    const availableCompetitors = this.competitorSkus.filter(comp => 
                        !this.comparedCompetitors.some(c => c.id === comp.id)
                    );
                    
                    if (availableCompetitors.length > 0) {
                        const randomIndex = Math.floor(Math.random() * availableCompetitors.length);
                        this.comparedCompetitors.push(availableCompetitors[randomIndex]);
                    } else {
                        alert('Все доступные конкуренты уже добавлены');
                    }
                },
                removeCompetitor(competitor) {
                    this.comparedCompetitors = this.comparedCompetitors.filter(c => c.id !== competitor.id);
                },
                updateComparisonTable() {
                    // Очищаем предыдущие значения
                    this.comparisonRows.forEach(row => {
                        row.values = {};
                    });
                    
                    // Добавляем данные для товара менеджера
                    if (this.selectedManagerSku) {
                        const prices = this.getPricesForPeriod(this.selectedManagerSku, 30);
                        const minPrice = Math.min(...prices);
                        const maxPrice = Math.max(...prices);
                        const avgPrice = Math.round(prices.reduce((sum, price) => sum + price, 0) / prices.length);
                        const prevPrice = prices.length > 1 ? prices[prices.length - 2] : prices[0];
                        const currentPrice = prices[prices.length - 1];
                        const priceTrend = currentPrice > prevPrice ? 'up' : currentPrice < prevPrice ? 'down' : null;
                        
                        this.comparisonRows[0].values.manager = {
                            value: currentPrice.toLocaleString('ru-RU') + ' ₽',
                            trend: priceTrend
                        };
                        this.comparisonRows[1].values.manager = {
                            value: minPrice.toLocaleString('ru-RU') + ' ₽',
                            trend: null
                        };
                        this.comparisonRows[2].values.manager = {
                            value: maxPrice.toLocaleString('ru-RU') + ' ₽',
                            trend: null
                        };
                        this.comparisonRows[3].values.manager = {
                            value: avgPrice.toLocaleString('ru-RU') + ' ₽',
                            trend: null
                        };
                        this.comparisonRows[4].values.manager = {
                            value: Math.floor(Math.random() * 5) + 1,
                            trend: null
                        };
                        this.comparisonRows[5].values.manager = {
                            value: (Math.random() * 1 + 4).toFixed(1) + ' из 5',
                            trend: null
                        };
                        this.comparisonRows[6].values.manager = {
                            value: 'В наличии',
                            trend: null
                        };
                        this.comparisonRows[7].values.manager = {
                            value: '1-3 дня',
                            trend: null
                        };
                        this.comparisonRows[8].values.manager = {
                            value: '1 год',
                            trend: null
                        };
                    }
                    
                    // Добавляем данные для конкурентов
                    this.comparedCompetitors.forEach(competitor => {
                        const prices = this.getPricesForPeriod(competitor, 30);
                        const minPrice = Math.min(...prices);
                        const maxPrice = Math.max(...prices);
                        const avgPrice = Math.round(prices.reduce((sum, price) => sum + price, 0) / prices.length);
                        const prevPrice = prices.length > 1 ? prices[prices.length - 2] : prices[0];
                        const currentPrice = prices[prices.length - 1];
                        const priceTrend = currentPrice > prevPrice ? 'up' : currentPrice < prevPrice ? 'down' : null;
                        
                        this.comparisonRows[0].values[competitor.id] = {
                            value: currentPrice.toLocaleString('ru-RU') + ' ₽',
                            trend: priceTrend
                        };
                        this.comparisonRows[1].values[competitor.id] = {
                            value: minPrice.toLocaleString('ru-RU') + ' ₽',
                            trend: null
                        };
                        this.comparisonRows[2].values[competitor.id] = {
                            value: maxPrice.toLocaleString('ru-RU') + ' ₽',
                            trend: null
                        };
                        this.comparisonRows[3].values[competitor.id] = {
                            value: avgPrice.toLocaleString('ru-RU') + ' ₽',
                            trend: null
                        };
                        this.comparisonRows[4].values[competitor.id] = {
                            value: Math.floor(Math.random() * 20) + 5,
                            trend: null
                        };
                        this.comparisonRows[5].values[competitor.id] = {
                            value: (Math.random() * 3 + 2).toFixed(1) + ' из 5',
                            trend: null
                        };
                        this.comparisonRows[6].values[competitor.id] = {
                            value: Math.random() > 0.2 ? 'В наличии' : 'Под заказ',
                            trend: null
                        };
                        this.comparisonRows[7].values[competitor.id] = {
                            value: Math.random() > 0.5 ? '1-3 дня' : '3-7 дней',
                            trend: null
                        };
                        this.comparisonRows[8].values[competitor.id] = {
                            value: Math.random() > 0.7 ? '2 года' : '1 год',
                            trend: null
                        };
                    });
                },
                toggleFullscreen() {
                    const chartContainer = document.querySelector('.chart-container');
                    if (!document.fullscreenElement) {
                        if (chartContainer.requestFullscreen) {
                            chartContainer.requestFullscreen();
                        }
                    } else {
                        if (document.exitFullscreen) {
                            document.exitFullscreen();
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
